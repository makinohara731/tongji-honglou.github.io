<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文章阅读 - 同济红楼社</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>tailwind.config = { theme: { extend: { colors: { 'red-dream': '#A62424', 'rice': '#F5F0E6' }, fontFamily: { 'song': ['SimSun', 'serif'] } } } }</script>
</head>
<body class="bg-rice font-song text-gray-800 flex flex-col min-h-screen">

    <!-- 导航栏由 js/main.js 自动生成 -->

    <article class="container mx-auto px-4 py-12 max-w-3xl bg-white mt-8 mb-8 shadow-lg rounded-lg flex-1">
        <div id="loading" class="text-center py-20">
            <i class="fa fa-spinner fa-spin text-3xl text-red-dream"></i>
        </div>
        
        <div id="content-area" class="hidden">
            <h1 id="art-title" class="text-3xl md:text-4xl font-bold text-red-dream mb-6 text-center"></h1>
            <div class="text-center text-gray-500 mb-8 pb-4 border-b border-gray-200 text-sm">
                <span><i class="fa fa-user mr-1"></i> <span id="art-author"></span></span>
                <span class="ml-4"><i class="fa fa-clock-o mr-1"></i> <span id="art-date"></span></span>
            </div>
            
            <img id="art-img" src="" class="w-full rounded-lg shadow-md mb-8 hidden">
            
            <div id="art-body" class="space-y-6 text-lg leading-relaxed"></div>
        </div>

        <!-- 评论区 -->
        <div class="mt-16 pt-8 border-t">
            <h3 class="text-lg font-bold text-red-dream mb-4">文章评论</h3>
            <div class="giscus"></div>
        </div>
    </article>

    <script src="js/data.js"></script>
    <script src="js/main.js"></script>
    <script>
        // 获取 URL 参数 ?id=xxx
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');
        
        const loading = document.getElementById('loading');
        const contentArea = document.getElementById('content-area');

        if (id && ARTICLES[id]) {
            const data = ARTICLES[id];
            
            // 填充内容
            document.title = data.title + " - 同济红楼社";
            document.getElementById('art-title').innerText = data.title;
            document.getElementById('art-author').innerText = data.author;
            document.getElementById('art-date').innerText = data.date;
            document.getElementById('art-body').innerHTML = data.content;
            
            if (data.image) {
                const img = document.getElementById('art-img');
                img.src = data.image;
                img.classList.remove('hidden');
            }

            loading.classList.add('hidden');
            contentArea.classList.remove('hidden');

            // 加载评论区 (Mapping = pathname, 这样每篇文章评论独立)
            const script = document.createElement('script');
            script.src = "https://giscus.app/client.js";
            script.setAttribute("data-repo", SITE_CONFIG.giscus.repo);
            script.setAttribute("data-repo-id", SITE_CONFIG.giscus.repoId);
            script.setAttribute("data-category", SITE_CONFIG.giscus.category);
            script.setAttribute("data-category-id", SITE_CONFIG.giscus.categoryId);
            script.setAttribute("data-mapping", "pathname"); // 这里用 pathname 即可
            script.setAttribute("data-strict", "0");
            script.setAttribute("data-reactions-enabled", "1");
            script.setAttribute("data-emit-metadata", "0");
            script.setAttribute("data-input-position", "top");
            script.setAttribute("data-theme", "noborder_light");
            script.setAttribute("data-lang", "zh-CN");
            script.setAttribute("data-loading", "lazy");
            script.setAttribute("crossorigin", "anonymous");
            script.setAttribute("async", "");
            document.querySelector('.giscus').appendChild(script);

        } else {
            loading.innerHTML = "<p class='text-red-500'>抱歉，文章未找到。</p><a href='index.html' class='underline'>返回首页</a>";
        }
    </script>
</body>
</html>